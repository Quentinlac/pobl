# ═══════════════════════════════════════════════════════════════════════════════
# BTC 15-MINUTE POLYMARKET BOT - CONFIGURATION
# ═══════════════════════════════════════════════════════════════════════════════
#
# This file controls how aggressive the bot is when making trading decisions.
# Adjust these settings based on your risk tolerance and bankroll.
#
# IMPORTANT: Environment variables are used for sensitive data (API keys, etc.)
# This file contains only strategy/behavior settings.
#
# ═══════════════════════════════════════════════════════════════════════════════

# ─────────────────────────────────────────────────────────────────────────────────
# POLLING SETTINGS
# How often the bot checks for opportunities
# ─────────────────────────────────────────────────────────────────────────────────
polling:
  # How often to fetch order book data (in milliseconds)
  # Lower = faster reaction but more API calls
  # CONSERVATIVE: 1000 (1 second)
  # MODERATE:     500  (0.5 seconds)
  # AGGRESSIVE:   250  (0.25 seconds)
  interval_ms: 500

  # How often to fetch current BTC price from Binance (milliseconds)
  # This determines price delta accuracy
  # CONSERVATIVE: 1000
  # MODERATE:     500
  # AGGRESSIVE:   200
  price_fetch_interval_ms: 500

  # Timeout for API requests (milliseconds)
  # Too short = missed opportunities, too long = stale data
  request_timeout_ms: 2000

# ─────────────────────────────────────────────────────────────────────────────────
# EDGE THRESHOLDS
# Minimum edge required before placing a bet
# Edge = (Our probability - Market probability) / Market probability
# ─────────────────────────────────────────────────────────────────────────────────
edge:
  # Minimum edge for STRONG confidence cells (n >= 100 samples)
  # CONSERVATIVE: 0.08  (8% edge required)
  # MODERATE:     0.05  (5% edge required)
  # AGGRESSIVE:   0.03  (3% edge required)
  min_edge_strong: 0.1

  # Minimum edge for MODERATE confidence cells (30 <= n < 100)
  # Should be higher than strong to compensate for uncertainty
  # CONSERVATIVE: 0.10  (10% edge)
  # MODERATE:     0.07  (7% edge)
  # AGGRESSIVE:   0.05  (5% edge)
  min_edge_moderate: 0.3

  # Minimum edge for WEAK confidence cells (10 <= n < 30)
  # Only bet on weak cells if edge is very high
  # CONSERVATIVE: 0.20  (20% edge) or skip entirely
  # MODERATE:     0.15  (15% edge)
  # AGGRESSIVE:   0.10  (10% edge)
  min_edge_weak: 0.50

  # Whether to bet on UNRELIABLE cells (n < 10)
  # Generally NOT recommended - too little data
  # Set to a very high value or use allow_unreliable: false
  allow_unreliable: false
  min_edge_unreliable: 0.30

# ─────────────────────────────────────────────────────────────────────────────────
# BET SIZING (Kelly Criterion)
# Controls how much of bankroll to risk per bet
# ─────────────────────────────────────────────────────────────────────────────────
betting:
  # Fraction of Kelly to use (1.0 = full Kelly, risky; 0.25 = quarter Kelly, safer)
  # CONSERVATIVE: 0.15  (15% of Kelly)
  # MODERATE:     0.25  (25% of Kelly - quarter Kelly)
  # AGGRESSIVE:   0.50  (50% of Kelly - half Kelly)
  kelly_fraction: 0.15

  # Additional multiplier based on confidence level
  # Reduces bet size for less confident predictions
  # These multiply with kelly_fraction
  confidence_multipliers:
    strong: 1.0     # Full kelly_fraction for strong confidence
    moderate: 0.6   # 60% of kelly_fraction for moderate
    weak: 0.3       # 30% of kelly_fraction for weak

  # Maximum bet as percentage of bankroll (safety cap)
  # Even with high edge, never bet more than this
  # CONSERVATIVE: 0.05  (5% max)
  # MODERATE:     0.10  (10% max)
  # AGGRESSIVE:   0.15  (15% max)
  max_bet_pct: 0.10

  # Minimum bet size in USDC
  # Below this, transaction costs make betting unprofitable
  min_bet_usdc: 1.0

  # Maximum single bet in USDC (absolute cap regardless of bankroll)
  # CONSERVATIVE: 50
  # MODERATE:     100
  # AGGRESSIVE:   500
  max_bet_usdc: 50.0

# ─────────────────────────────────────────────────────────────────────────────────
# TIMING RESTRICTIONS
# When during the 15-minute window to allow betting
# ─────────────────────────────────────────────────────────────────────────────────
timing:
  # Don't bet in the first N seconds (prices too volatile at open)
  # CONSERVATIVE: 120  (wait 2 minutes)
  # MODERATE:     60   (wait 1 minute)
  # AGGRESSIVE:   30   (wait 30 seconds)
  min_seconds_elapsed: 0

  # Don't bet in the last N seconds (not enough time for execution)
  # This accounts for order placement + confirmation time
  # CONSERVATIVE: 30   (stop 30s before end)
  # MODERATE:     15   (stop 15s before end)
  # AGGRESSIVE:   10   (stop 10s before end)
  min_seconds_remaining: 15

  # Only bet when time bucket has enough historical data
  # Skips time buckets that historically have low sample counts
  min_samples_in_bucket: 30

# ─────────────────────────────────────────────────────────────────────────────────
# PRICE MOVEMENT RESTRICTIONS
# Filter out extreme price movements that may be anomalies
# ─────────────────────────────────────────────────────────────────────────────────
price_filters:
  # Skip if price delta exceeds this amount (potential data error or flash crash)
  # CONSERVATIVE: 400  (skip if >$400 move)
  # MODERATE:     600  (skip if >$600 move)
  # AGGRESSIVE:   1000 (rarely skip)
  max_price_delta: 400.0

  # Skip if price changed more than this % since window start
  # CONSERVATIVE: 0.5  (0.5% max move)
  # MODERATE:     1.0  (1% max move)
  # AGGRESSIVE:   2.0  (2% max move)
  max_price_change_pct: 1.0

# ─────────────────────────────────────────────────────────────────────────────────
# ORDER EXECUTION
# How to place and manage orders
# ─────────────────────────────────────────────────────────────────────────────────
execution:
  # Order type: "market" (faster) or "limit" (better price but may not fill)
  # CONSERVATIVE: "limit"  (may miss opportunities but better prices)
  # AGGRESSIVE:   "market" (guaranteed fill but potential slippage)
  order_type: "market"

  # For limit orders: how much worse than best price to accept (in cents)
  # Lower = better price but less likely to fill
  # CONSERVATIVE: 0.5  (0.5 cents)
  # MODERATE:     1.0  (1 cent)
  # AGGRESSIVE:   2.0  (2 cents)
  limit_price_offset_cents: 1.0

  # Slippage tolerance for market orders (percentage of price)
  # Order fails if execution price exceeds this
  # CONSERVATIVE: 0.01 (1%)
  # MODERATE:     0.02 (2%)
  # AGGRESSIVE:   0.05 (5%)
  max_slippage_pct: 0.02

  # Retry failed orders
  # CONSERVATIVE: false (no retry, move on)
  # AGGRESSIVE:   true  (retry once)
  retry_on_failure: false
  max_retries: 1

# ─────────────────────────────────────────────────────────────────────────────────
# RISK MANAGEMENT
# Overall limits to prevent catastrophic losses
# ─────────────────────────────────────────────────────────────────────────────────
risk:
  # Maximum number of bets per 15-minute window
  # CONSERVATIVE: 1  (one bet per window max)
  # MODERATE:     2  (can adjust position once)
  # AGGRESSIVE:   5  (frequent adjustments)
  max_bets_per_window: 10

  # Stop trading for the day if total loss exceeds this % of starting bankroll
  # CONSERVATIVE: 0.05 (stop at 5% daily loss)
  # MODERATE:     0.10 (stop at 10% daily loss)
  # AGGRESSIVE:   0.20 (stop at 20% daily loss)
  daily_loss_limit_pct: 0.10

  # Reduce bet sizes after consecutive losses
  # Each loss multiplies bet size by this factor
  # CONSERVATIVE: 0.5  (halve bet after each loss)
  # MODERATE:     0.75 (reduce by 25% per loss)
  # AGGRESSIVE:   1.0  (no reduction)
  loss_reduction_factor: 0.75

  # Reset loss reduction after N consecutive wins
  consecutive_wins_to_reset: 2

  # Maximum concurrent open positions (across all windows)
  # CONSERVATIVE: 1
  # MODERATE:     3
  # AGGRESSIVE:   5
  # Set to 999 to effectively disable this limit
  max_open_positions: 999

# ─────────────────────────────────────────────────────────────────────────────────
# MARKET SELECTION
# Which Polymarket BTC markets to trade
# ─────────────────────────────────────────────────────────────────────────────────
markets:
  # Token IDs for BTC 15-minute UP/DOWN markets
  # These are the condition IDs from Polymarket's CLOB
  # The bot will automatically find the current active market
  btc_up_token_id: ""    # Set via env: POLYMARKET_BTC_UP_TOKEN
  btc_down_token_id: ""  # Set via env: POLYMARKET_BTC_DOWN_TOKEN

  # Market condition ID (parent of UP/DOWN tokens)
  condition_id: ""  # Set via env: POLYMARKET_BTC_CONDITION_ID

  # Minimum liquidity required to place bet (in USDC)
  # Skip if order book is too thin
  # CONSERVATIVE: 500  (need $500 liquidity)
  # MODERATE:     200  (need $200 liquidity)
  # AGGRESSIVE:   50   (accept thin books)
  min_liquidity_usdc: 200.0

  # Maximum spread to accept (ask - bid as percentage of mid price)
  # Note: For cheap tokens (e.g., 5¢), even 1¢ spread = 20%!
  # CONSERVATIVE: 0.05 (5% max spread)
  # MODERATE:     0.15 (15% max spread)
  # AGGRESSIVE:   0.30 (30% max spread - allows trading cheap tokens)
  max_spread_pct: 0.30

# ─────────────────────────────────────────────────────────────────────────────────
# COOLDOWN (LOGGING ONLY)
# Note: Betting cooldowns are now per-strategy (see terminal_strategy and exit_strategy)
# ─────────────────────────────────────────────────────────────────────────────────
cooldown:
  # DEPRECATED: Use terminal_strategy.cooldown_ms and exit_strategy.cooldown_ms
  # This setting is no longer used for betting cooldowns
  min_seconds_between_bets: 30

  # Cooldown after a skipped opportunity (to avoid log spam)
  # Set to 0 to log every check, or higher to reduce noise
  log_cooldown_seconds: 5

# ─────────────────────────────────────────────────────────────────────────────────
# TERMINAL STRATEGY (hold to settlement)
# Original strategy - buy and hold until window resolves
# ─────────────────────────────────────────────────────────────────────────────────
terminal_strategy:
  # Enable/disable terminal strategy
  enabled: true

  # Minimum BUY edge required (Our P - Market P) / Market P
  # BACKTESTED: B7%_S10%_P0%_Minf with $1 bets
  # CONSERVATIVE: 0.15 (15% edge)
  # MODERATE:     0.10 (10% edge)
  # AGGRESSIVE:   0.07 (7% edge)
  min_edge: 0.07

  # Minimum SELL edge required (Bid P - Our P) / Bid P
  # When positive, market is paying MORE than we think token is worth
  # BACKTESTED: 0.10 (10% edge) - allows early exit when favorable
  # CONSERVATIVE: 0.15 (15% edge)
  # MODERATE:     0.10 (10% edge)
  # AGGRESSIVE:   0.05 (5% edge)
  min_sell_edge: 0.10

  # Minimum PROFIT required before allowing sell (entry to current price)
  # Only sell if (current_bid - entry_price) / entry_price >= this value
  # Prevents selling at a loss even if sell edge looks good
  # BACKTESTED: 0.00 (0% profit) - take any profit with sell edge
  # CONSERVATIVE: 0.10 (10% profit)
  # MODERATE:     0.05 (5% profit)
  # AGGRESSIVE:   0.00 (no profit requirement)
  min_profit_before_sell: 0.00

  # Maximum bet size in USDC for terminal bets
  # BACKTESTED: $1 per bet (lower capital, more trades)
  # CONSERVATIVE: 1
  # MODERATE:     5
  # AGGRESSIVE:   10
  max_bet_usdc: 1.0

  # Maximum terminal bets per 15-minute window
  # BACKTESTED: unlimited (9999) - take all opportunities
  # CONSERVATIVE: 1
  # MODERATE:     20
  # AGGRESSIVE:   9999 (unlimited)
  max_bets_per_window: 9999

  # Don't place terminal bets in last N seconds
  # Need time for order to fill before settlement
  # CONSERVATIVE: 30
  # MODERATE:     15
  # AGGRESSIVE:   5
  min_seconds_remaining: 15

  # Cooldown between terminal bets (milliseconds)
  # 500 = 0.5 seconds, 1000 = 1 second
  # CONSERVATIVE: 60000 (1 minute)
  # MODERATE:     1000 (1 second)
  # AGGRESSIVE:   500 (0.5 seconds)
  cooldown_ms: 500

  # ─────────────────────────────────────────────────────────────────────────────
  # TAKE-PROFIT SETTINGS (Early exit for terminal positions)
  # Sell terminal positions early if profit target is hit
  # Target decreases as time progresses (higher target early, lower later)
  # ─────────────────────────────────────────────────────────────────────────────
  take_profit:
    # Enable/disable take-profit for terminal positions
    enabled: false

    # Profit targets based on time elapsed in window
    # Format: max_seconds = time threshold, profit_pct = required profit to sell
    # Targets are checked in order - first matching target applies
    targets:
      # First 5 minutes (0-300s): Need +50% profit to sell early
      - max_seconds: 300
        profit_pct: 0.50

      # 5-10 minutes (300-600s): Need +30% profit to sell early
      - max_seconds: 600
        profit_pct: 0.30

      # Last 5 minutes (600-900s): Need +15% profit to sell early
      - max_seconds: 900
        profit_pct: 0.15

# ─────────────────────────────────────────────────────────────────────────────────
# EXIT STRATEGY (sell at target before settlement)
# New strategy - buy early, sell when price target is hit
# Uses first-passage matrix to calculate optimal exit targets
# ─────────────────────────────────────────────────────────────────────────────────
exit_strategy:
  # Enable/disable exit strategy
  # Requires first-passage matrix file: output/first_passage_matrix.json
  enabled: false

  # Minimum EV return required (expected profit / entry price)
  # CONSERVATIVE: 0.10 (10% EV return)
  # MODERATE:     0.05 (5% EV return)
  # AGGRESSIVE:   0.03 (3% EV return)
  min_edge: 0.05

  # Maximum bet size in USDC for exit strategy bets
  # Keep smaller than terminal since we're taking profits early
  # CONSERVATIVE: 3
  # MODERATE:     5
  # AGGRESSIVE:   10
  max_bet_usdc: 5.0

  # Maximum exit strategy bets per 15-minute window
  # Can be higher than terminal since each bet is smaller
  # CONSERVATIVE: 5
  # MODERATE:     10
  # AGGRESSIVE:   20
  max_bets_per_window: 60

  # Don't place exit bets in last N seconds
  # Need enough time remaining to hit exit target
  # CONSERVATIVE: 420 (7 min remaining = first 8 min only)
  # MODERATE:     300 (5 min remaining = first 10 min only)
  # AGGRESSIVE:   180 (3 min remaining = first 12 min only)
  min_seconds_remaining: 300

  # Only use Strong confidence cells from first-passage matrix
  # true = safer, only bet when we have lots of data
  # false = also use Moderate confidence (more opportunities, less certain)
  only_strong_confidence: true

  # Cooldown between exit strategy bets (milliseconds)
  # CONSERVATIVE: 30000 (30 seconds)
  # MODERATE:     1000 (1 second)
  # AGGRESSIVE:   500 (0.5 seconds)
  cooldown_ms: 500

# ─────────────────────────────────────────────────────────────────────────────────
# LOGGING & MONITORING
# ─────────────────────────────────────────────────────────────────────────────────
logging:
  # Log level: "debug", "info", "warn", "error"
  level: "info"

  # Log every price check (verbose, good for debugging)
  log_price_checks: true

  # Log when skipping opportunities (helps understand behavior)
  log_skipped_opportunities: true

  # Log full order book snapshots
  log_order_book: true

  # Log decision reasoning (shows why bet was/wasn't placed)
  log_decision_reasoning: true

# ─────────────════════════════════════════════════════════════════════════════════
# PRESET PROFILES
# Uncomment one of these sections to use a predefined configuration
# ─────────────────────────────────────────────────────────────────────────────────

# # CONSERVATIVE PRESET
# # For beginners or when testing with real money
# # Low risk, requires high edge, small bets
# preset: "conservative"
# # Overrides:
# # - edge.min_edge_strong: 0.08
# # - betting.kelly_fraction: 0.15
# # - betting.max_bet_pct: 0.05
# # - risk.max_bets_per_window: 1
# # - risk.daily_loss_limit_pct: 0.05

# # MODERATE PRESET (DEFAULT)
# # Balanced approach, recommended for most users
# preset: "moderate"

# # AGGRESSIVE PRESET
# # For experienced traders with larger bankroll
# # Higher risk, lower edge threshold, larger bets
# preset: "aggressive"
# # Overrides:
# # - edge.min_edge_strong: 0.03
# # - betting.kelly_fraction: 0.50
# # - betting.max_bet_pct: 0.15
# # - risk.max_bets_per_window: 3
# # - risk.daily_loss_limit_pct: 0.20
